# =============================================================================
# Aerospike Cluster Manager - Helm Values
# =============================================================================

# -- Number of replicas
replicaCount: 1

# -- Container image settings
image:
  # -- Container image repository
  repository: ghcr.io/kimsoungryoul/aerospike-cluster-manager
  # -- Container image tag; defaults to Chart.appVersion when empty
  tag: ""
  # -- Image pull policy
  pullPolicy: IfNotPresent

# -- Image pull secrets for private registries
imagePullSecrets: []

# -- Override the chart name
nameOverride: ""
# -- Override the full resource name
fullnameOverride: ""

# =============================================================================
# Service Account & RBAC
# =============================================================================
serviceAccount:
  # -- Create a service account
  create: true
  # -- Annotations for the service account
  annotations: {}

rbac:
  # -- Create ClusterRole and ClusterRoleBinding for K8s API access
  create: true

# =============================================================================
# Service
# =============================================================================
service:
  # -- Service type
  type: ClusterIP
  # -- Frontend port
  frontendPort: 3000
  # -- Backend port
  backendPort: 8000

# =============================================================================
# Ingress
# =============================================================================
ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Ingress annotations
  annotations: {}
  # -- Ingress hosts
  hosts:
    - host: aerospike-admin.local
      paths:
        - path: /
          pathType: Prefix
  # -- Ingress TLS configuration
  tls: []

# =============================================================================
# PostgreSQL
# =============================================================================
postgresql:
  # -- Deploy an embedded PostgreSQL sidecar container.
  # Disable this and set env.databaseUrl to use an external PostgreSQL instance.
  enabled: true
  # -- Name of an existing Secret containing POSTGRES_PASSWORD and DATABASE_URL keys.
  # When set, the chart will not create its own Secret.
  existingSecret: ""
  # -- PostgreSQL container image
  image:
    repository: postgres
    tag: "17-alpine"
    pullPolicy: IfNotPresent
  # -- Database name
  database: aerospike_manager
  # -- Database user
  username: aerospike
  # -- Database password (used for embedded sidecar only; ignored when existingSecret is set)
  password: aerospike
  # -- Resource requests and limits for the PostgreSQL sidecar
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# =============================================================================
# Persistence (PostgreSQL data)
# =============================================================================
persistence:
  # -- Enable persistent storage for the embedded PostgreSQL database
  enabled: true
  # -- Storage class name (empty = default)
  storageClassName: ""
  # -- Access mode
  accessMode: ReadWriteOnce
  # -- Volume size
  size: 1Gi

# =============================================================================
# K8s Cluster Management
# =============================================================================
k8s:
  # -- Enable Kubernetes cluster management features (Create Cluster)
  enabled: true

# =============================================================================
# Resources
# =============================================================================
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# =============================================================================
# Security Context
# =============================================================================
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# =============================================================================
# Probes
# =============================================================================
livenessProbe:
  httpGet:
    path: /api/health
    port: backend
  initialDelaySeconds: 15
  periodSeconds: 20
  timeoutSeconds: 5

readinessProbe:
  httpGet:
    path: /api/health
    port: backend
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5

startupProbe:
  httpGet:
    path: /api/health
    port: backend
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

# =============================================================================
# Environment
# =============================================================================
env:
  # -- Backend CORS origins (empty = no CORS; frontend proxies via Next.js rewrites)
  corsOrigins: ""
  # -- Log level
  logLevel: "INFO"
  # -- External PostgreSQL connection URL.
  # Only used when postgresql.enabled is false.
  # Example: "postgresql://user:pass@db-host:5432/aerospike_manager"
  databaseUrl: ""

# =============================================================================
# Scheduling
# =============================================================================
nodeSelector: {}
tolerations: []
affinity: {}

# -- Topology spread constraints for pod scheduling
topologySpreadConstraints: []

# -- Pod annotations
podAnnotations: {}

# -- Additional labels to add to the pods
podLabels: {}

# -- Termination grace period in seconds
terminationGracePeriodSeconds: 45

# =============================================================================
# Aerospike Ports
# =============================================================================
aerospikePorts:
  # -- Aerospike service port
  service: 3000
  # -- Aerospike fabric port
  fabric: 3001
  # -- Aerospike heartbeat port
  heartbeat: 3002

# =============================================================================
# Network Policy
# =============================================================================
networkPolicy:
  # -- Enable NetworkPolicy for restricting ingress/egress traffic
  enabled: false
  # -- Optional ingress source restrictions (namespaceSelector, podSelector)
  # Example:
  #   ingressFrom:
  #     - namespaceSelector:
  #         matchLabels:
  #           name: ingress-nginx
  #     - podSelector:
  #         matchLabels:
  #           app: my-frontend
  ingressFrom: []

# =============================================================================
# Pod Disruption Budget
# =============================================================================
podDisruptionBudget:
  # -- Enable PodDisruptionBudget
  enabled: false
  # -- Minimum number of pods that must remain available (mutually exclusive with maxUnavailable)
  minAvailable: 1
  # -- Maximum number of pods that can be unavailable (mutually exclusive with minAvailable).
  # Uncomment and remove minAvailable to use.
  # maxUnavailable: 1

# =============================================================================
# Autoscaling (HPA)
# =============================================================================
autoscaling:
  # -- Enable Horizontal Pod Autoscaler
  enabled: false
  # -- Minimum number of replicas
  minReplicas: 1
  # -- Maximum number of replicas
  maxReplicas: 3
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # -- Target memory utilization percentage (optional, uncomment to enable)
  # targetMemoryUtilizationPercentage: 80

# =============================================================================
# Extra Environment Variables
# =============================================================================
# -- Extra environment variables to set on the container
# Example:
#   extraEnv:
#     - name: MY_VAR
#       value: "my-value"
extraEnv: []

# =============================================================================
# Helm Tests
# =============================================================================
tests:
  # -- Enable Helm test pods (run with `helm test <release>`)
  enabled: true
